---
layout: post
title: 编写编译器和解释器
date: 2018-06-18 14:00:00 +0800
categories: 编译器
tags: 随笔
toc: true
comments: true
---
从
https://github.com/rspivak/lsbasi
看到了这篇文章，它不仅深入浅出地讲述了怎么从头写一个编译器、解释器，其中有不少闪光的观点值得品味。

<!-- more -->
文章系列共14篇，首篇开头就引入[Steve Yegge](http://steve-yegge.blogspot.com/)牛的一句话——“如果你不知道编译器是如何工作的，你就不会理解计算机是如何工作的。如果你不能100%确认你深刻理解编译器的工作原理，那么你多半是不理解的”。关于[Steve Yegge](http://steve-yegge.blogspot.com/)又是一个有意思的大牛，他有很多博客文章被翻译成中文。

通常学习一门技能都会被教育为什么要学习，而我一般都不看这类陈述，一方面因为我在学习之前对于为什么要学已经想得很清楚，另一方面这类描述像拉客的广告一样没啥新意。但在这篇文章里关于“为什么”我还是读了两遍：

1. 写一个编译器和解释器，需要组合使用很多种技术，这些技术在写任何软件的时候都是有用的。这有助于你提升这些技能，并成为更牛逼的软件工程师。
2. 帮助你深刻理解计算机是如何工作的。编译器和解释器在外部看来就像魔术一样，但是你不应该满足于这种境界，而应该揭开构建它们的神秘面纱，理解内部机制让一切尽在掌控。
3. 如果你要创建自己的编程语言，或者特定领域的编程语言，你就必须自己写解释器和编译器。最近新的编程语言不断涌现，Elixir, Go, Rust等等。

第1点是我在读完全部文章后感同身受的，本来不打算在这个层面花太多精力，因为我在今年学习的路线图是机器学习，了解编译器是为了解决iOS下使用OC热更新的问题。但是读了这一系列的文章之后，不仅决定再深入精读一遍，还有必要跟着一起动手玩玩，这是一段有趣、有料的旅程。

第3点听起来有点牵强，尽管编程语言层出不穷，但这世界上需要自己设计编程语言并且有价值的仍是凤毛麟角。但最近还真是遇到了这类的挑战——我的目标不是设计一门被广泛应用的编程语言，而是要设计一个OC的编译器和解释器，以支持iOS下代码的热更新。

# 什么是编译器和解释器？

翻译器和解释器的作用都是将高级语言写的源代码翻译成更低级的形式。**编译器Compiler**直接将它翻译成机器语言，而**解释器Interpreper**则是将它翻译成介于高级语言和机器语言的中间形式。参考《计算机系统要素——从零开始构建现代计算机》的插图：
![](0618BuildASimpleInterpreter1/img01.png)

图中的**编译器+虚拟机+汇编编译器**是本文说的编译器，图中的**编译器**是本文中的解释器。

解释器的处理过程如下：

![](0618BuildASimpleInterpreter1/img02.png)

# 词法分析器
